<!DOCTYPE html>
<html xmlns:th="http://www.tyhmeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head th:replace="fragments/head :: headFragment"></head>
	<th:block layout:fragment="customTitle">
		<title>입출금 입력</title>
	</th:block>
<body>
      	<div class="pull-right" style="margin-right: 30px;">
      		<a class="btn btn-info" th:href=@{/bidMoneyCheck(curPage=${page.curPage},searchKey=${searchKey},searchValue=${searchValue})}>돌아가기</a>
      	</div>
		<div class="row mt">
          <div class="col-lg-12">
            <div class="content-panel" style="padding : 30px; margin: 30px;">
				<h4><i class="fa fa-angle-right"></i> 입출금 입력</h4>
	              <section id="no-more-tables">
					<table class="table table-condensed cf">
						<thead class="cf">
							<tr>
								<th>번호</th>
								<th>목적</th>
								<th>거래회원</th>
								<th>관련공고</th>
								<th>시작일자</th>
								<th>마감일자</th>
								<th>금액</th>
								<th>입출금구분</th>
								<th>입출금시간</th>
								<th>거래회원계좌</th>
								<th>예금주명</th>
								<th>입출금입력</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${#lists.size(moneyCheckList) > 0}" th:each="l, status : ${moneyCheckList}">
								<td>[[${status.count+(page.curPage-1)*page.pageEnd}]]</td>
								<td th:if="${#strings.substring(l.Code,0,#strings.indexOf(l.Code,'_')) == 'b'}">
									예치금입금
								</td>
								<td th:if="${#strings.substring(l.Code,0,#strings.indexOf(l.Code,'_')) == 'payin'}">
									대금입금
								</td>
								<td th:if="${#strings.substring(l.Code,0,#strings.indexOf(l.Code,'_')) == 'payout'}">
									대금출금
								</td>
								<td th:if="${#strings.substring(l.Code,0,#strings.indexOf(l.Code,'_')) == 'deout'}">
									예치금환불
								</td>
								<td>
									[[${l.Id}]]
									<input type="hidden" id="Id" th:value="${check.Id}">
									<input type="hidden" id="Code" th:value="${check.Code}">
									<input type="hidden" id="nCode" th:value="${check.nCode}">
								</td>
								<td>[[${l.nTitle}]]</td>
								<td>[[${l.startDate}]]</td>
								<td>[[${l.endDate}]]</td>
								<td>
									[[${l.money}]]
									<input type="hidden" id="money" th:value="${check.money}">
								</td>
								<td>
									[[${l.iOut}]]
									<input type="hidden" id="iOut" th:value="${check.iOut}">
								</td>
								<td th:if="${l.Code} == ${check.Code}">
									<input type="text" id="inoutDate" th:value="${check.inoutDate}">
								</td>
								<td th:unless="${l.Code} == ${check.Code}">
									[[${l.inoutDate}]]
								</td>
								<td>([[${l.bankName}]]) [[${l.accountNumber}]]</td>
								<td>[[${l.accountName}]]</td>
								<td th:if="${l.Code} == ${check.Code}">
									<button class="btn btn-success" type="button" onclick="checkFinish()">확인</button> 
								</td>
								<td th:unless="${l.Code} == ${check.Code}">
									<a class="btn btn-info" th:href=@{/bidMoneyInsert(Code=${l.Code},curPage=${page.curPage},searchKey=${searchKey},searchValue=${searchValue})}>입력</a>
								</td>
							</tr>
							<tr th:unless="${#lists.size(moneyCheckList) > 0}">
								<td colspan="12">조회된 내용이 없습니다.</td>
							</tr>
						</tbody>
					</table>
					<div class="text-center">
					  <ul class="pagination">
					    <li>
					      <a th:if="${page.curBlock > 1}" th:href="@{/bidMoneyInsert(Code=${check.Code},curPage=${page.prevPage},searchKey=${searchKey},searchValue=${searchValue})}" aria-label="Previous">
					        <span aria-hidden="true">&laquo;</span>
					      </a>
					    </li>
				    	<th:block th:each="num : ${#numbers.sequence(page.blockBegin, page.blockEnd)}">
				   		<li th:if="${num == page.curPage}" class="active">
				   			<a>[[${num}]]</a>
				   		</li>
				   		<li th:unless="${num == page.curPage}">
				   		<th:block th:if="${num} != 0">
				   			<a th:href="@{/bidMoneyInsert(Code=${check.Code},curPage=${num},searchKey=${searchKey},searchValue=${searchValue})}">[[${num}]]</a>
				   		</th:block>
				   		</li>
				  		</th:block>
					    <li>
					      <a th:if="${page.curBlock <= page.totBlock}" th:href="@{/bidMoneyInsert(Code=${check.Code},curPage=${page.nextPage},searchKey=${searchKey},searchValue=${searchValue})}" aria-label="Next">
					        <span aria-hidden="true">&raquo;</span>
					      </a>
					    </li>
					  </ul>
					</div>
				</section>
			  </div>
		 	</div>
		 </div>
        
	
	<script type="text/javascript">
		
		function checkFinish(){
			var Code = $('#Code');
			var nCode = $('#nCode');
			var Id = $('#Id');
			var money = $('#money');
			var iOut = $('#iOut');
			var inoutDate = $('#inoutDate');
			
			var request = $.ajax({
				url: "/ajax/bidMoneyInsertSend",
				method: "post",
				data: { Code : Code.val(), 
						nCode : nCode.val(),
						Id : Id.val(),
						money : money.val(),
						iOut : iOut.val(),
						inoutDate : inoutDate.val()	}
				
			});
			
			request.done(function(data){
				opener.document.location.href="/profit/balance";
				window.close();
			});
			
			request.fail(function( jqXHR, textStatus){
				alert( "Request failed: " + textStatus);
			});
		}
		
		
	</script>
	
</body>	
</body>
</html>