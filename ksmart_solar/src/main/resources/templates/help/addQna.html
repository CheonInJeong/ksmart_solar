<!DOCTYPE html>
<html xmlns:th="http://www.tyhmeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="layout/default">

<th:block layout:fragment="customTitle">
	<title>문의사항 등록</title>
</th:block>

<th:block layout:fragment="customCss">
</th:block>

<th:block layout:fragment="Contents">
	<div id="container-header-title">
		<strong>문의사항 등록</strong>
	</div>
	<div id="container-header-path">
		<a href="/" style="text-decoration: none;"> 메인화면 </a>> 고객센터 >
	   	<a href="/help/qna" style="text-decoration: none;"> 문의사항 </a>>
	   	<a href="/help/addQna" style="text-decoration: none;"> 문의사항 등록 </a>
	</div>
	<div id="container-header-space"></div>

	<div class="row mt">
		<div class="col-lg-12">
			 <div class="content-panel" style="padding: 30px;">
				<h4 class="mb">
					<i class="fa fa-angle-right"></i>문의사항 등록
				</h4>
				<form id="form" method="post" name="form" class="form-horizontal style-form">
					<input type="text" hidden="hidden" name="mId" th:value="${session.SID}">
					<input type="hidden" name="bQnaIdx" th:value="${boardQnaDTO != null ? boardQnaDTO.bQnaIdx : 0}"/>
					<div class="form-group">
						<label class="col-sm-2 col-sm-2 control-label">문의제목</label>
						<div class="col-lg-10">
							<input type="text" name="bQnaSubject" id="bQnaSubject" class="form-control" th:value="${boardQnaDTO != null ? boardQnaDTO.bQnaSubject : ''}">
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 col-sm-2 control-label">문의내용</label>
						<div class="col-lg-10">
							<textarea name="bQnaContents" rows="30" id="bQnaContents" class="form-control"  th:text="${boardQnaDTO != null ? boardQnaDTO.bQnaContents : ''}"></textarea>
						</div>
					</div>
					<div class="form-group">
						<label class="col-sm-2 col-sm-2 control-label">비밀글 여부</label>
						<div class="col-lg-10">
							<label> Y <input type="radio" value="Y" name="bQnaOpen">
							</label> 
							<label> N <input type="radio" value="N" name="bQnaOpen">
							</label>
						</div>
					</div>
						<div id="password" style="display:none" class="form-group" >
							<label class="col-sm-2 col-sm-2 control-label">비밀글 암호</label>
							<div class="col-lg-10">
								<input type="text" name="bQnaPassword" class="form-control">
							</div>
						</div>

						<div class="form-group">
							<div class="col-lg-offset-2 col-lg-10">
								<a class="btn btn-primary" onclick="list()">목록</a> 
								<a class="btn btn-info" data-toggle="modal" data-target="#qnaModal" data-whatever="@mdo">불러오기</a>
							</div>
						</div>
							<input hidden="hidden" name="uri" value="저장" />
						<div style="text-align: center">
							<input type="submit" class="btn btn-info" id="saveQnaBtn" value="임시저장" formaction="/help/saveQna">
							<button type="submit" class="btn btn-success" id="qnaBtn" formaction="/help/addQna" >등록</button>
						</div>
				</form>
			</div>
		</div>
	</div>
	
	
	<div class="modal fade" id="qnaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="exampleModalLabel">임시저장 글 불러오기</h4>
					</div>
					
					<div class="modal-body">
                	<th:block th:if="${boardQnaDTOList != null}" th:each="l:${boardQnaDTOList}">
                		<div>
                			<form th:action="@{/help/getLoadQna}" method="get">
                				<a class="qnaTitle" style="cursor: pointer" th:text="${l.bQnaSubject}"></a>
                				<input type="hidden" name="bQnaIdx"  th:value="${l.bQnaIdx}">
							</form>		                		
	                		<p th:text="${l.bQnaRegDate}"></p>
	                		<input type="hidden" class="bQnaIdx" th:value="${l.bQnaIdx}">
	                		<span class="btn btn-danger btn-xs delete">삭제</span>
	                		<hr>
                		</div>
                	</th:block>
                	
                	<th:block th:if="${boardQnaDTOList == null}">
                		<p>저장된 문의가 없습니다.</p>
                	</th:block>
					
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
					</div>
					
					</div>
			</div>
		</div>
	</div>
	
</th:block>

<th:block layout:fragment="customScript">

	<script type="text/javascript">
	
		//목록 가기전 임시저장 여부 확인
		var bQnaSubject = $('#bQnaSubject');
		var bQnaContents = $('#bQnaContents');
		
		function list(){
			if((bQnaSubject.val() != null && bQnaSubject.val() != '') || (bQnaContents.val() != null && bQnaContents.val() != '')){
				var result = confirm("임시 저장하시겠습니까?");
				if(result){
						console.log(result);
						console.log(bQnaSubject.val());
						console.log(bQnaContents.val());
						console.log($('#saveQnaBtn'));
						$('[name="uri"]').val('목록');
						$('#saveQnaBtn').trigger('click');
					//document.getElementById('form').action="/help/saveQna";
			        //document.getElementById('form').submit();
				}else{
					console.log(result);
					return false;
				}
			}else{
				location.href = "/help/qna"
			}
		}; 
		
		//삭제
		$('.delete').click(function(){
			console.log('삭제버튼')
			var bQnaIdx = $(this).parent().find('.bQnaIdx').val();
			console.log(bQnaIdx);
			var a = $(this);
			$.ajax({
		        url     : '/ajax/delete',
		        type    : 'POST',
		        data    : {bQnaIdx : bQnaIdx},
		        success : function(data) {
		        	console.log(data=='삭제');
		        	if(data){
		        		console.log('삭제 성공');
		        		a.parent().remove();
		        	}else{
		        		
		        	}
		        },
		        error : function(xhr,status,error) {
		        	console.log("xhr: " + xhr);
		        	console.log("status: " + status);
		        	console.log("error: " + error);
		        }
		    });
		});
          
		
		
	
		//비밀글 암호 오픈,클로즈
		$('input[name=bQnaOpen]').on('change', function() {
			var bQnaOpenValue = $('input[name=bQnaOpen]:checked').val();
			
			if (bQnaOpenValue == 'Y') {
			$('#password').css('display', 'block');
			return false;
			} else if (bQnaOpenValue == 'N') {
			$('#password').css('display', 'none');
			return false;
			}
		});
	
	  
		//메뉴탭
		var help = $('#help');
		help.addClass('active');
		help.parent().find('.sub').css('display', 'block');
		help.parent().find('.sub').children().eq(1).addClass('active');
		
		
		//유효성검사
		 $('#qnaBtn').click(function(){
		 	if($('[name="bQnaSubject"]').val()==''){
				alert('문의제목을 입력해주세요.');
				$('[name="bQnaSubject"]').focus();
				return false;
			}if($('[name="bQnaContents"]').val()==''){
				alert('문의내용을 입력해주세요.')
				$('[name="bQnaContents"]').focus();
				return false;
			}if($('[name="bQnaOpen"]:checked').length==0){
				alert('비밀글여부를 선택해주세요.')
				return false;
			}
			if($('[name="bQnaOpen"]:checked').val=='Y'){
				if($('[name="bQnaPassword"]').val()==''){
					alert('비밀글암호를 입력해주세요.')
					$('[name="bQnaPassword"]').focus();
					return false;
				}
			}
		 })
		 
		 
	
		 //임시저장글 불러오기
			$('.qnaTitle').click(function(){
				$(this).parent().submit();
			});
	</script>
</th:block>
</html>