<html xmlns:th="http://www.tyhmeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="layout/default">

<th:block layout:fragment="customTitle">
	<title>문의하기</title>
</th:block>

<th:block layout:fragment="customCss">

	<style>
	th, tbody {
		text-align:center;
	}
	</style>
	
</th:block>

<th:block layout:fragment="Contents">
	<div id="container-header-title">
		<strong>문의사항</strong>
	</div>
	<div id="container-header-path">
		<a href="/" style="text-decoration: none;"> 메인화면 </a>> 고객센터 >
	   	<a href="/help/qna" style="text-decoration: none;"> 문의사항 </a>
	</div>
	<div id="container-header-space"></div>
	<div class="row mt">
		<div class="col-md-12">
			 <div class="content-panel" style="padding: 30px;">
			 	<div style="text-align : right; margin-bottom: 10px;">
					<a th:if="${session.SLEVELNUM!=1}" class="btn standardBtn" th:href=@{/help/addQna}>문의등록</a>
			 	</div>
				<h4>
					<i class="fa fa-angle-right"></i> 문의사항
				</h4>
				<div style="text-align : right; margin-bottom: 10px;">
	              <form th:action="@{/help/qna}" method="get">
	            	<select name="searchKey">
	            		<option value="">선택</option>
	            		<option value="bQnaSubject">문의제목</option>
	            		<option value="mId">작성자</option>
	            	</select>
	            	<input type="text" placeholder="검색어" name="searchValue">
	            	<input type="submit" value = "검색" class="btn btn-default btn-sm">
	               </form>
                </div>
				
				<section id="no-more-tables">
					<hr>
					<table class="table table-condensed cf">
						<thead class="cf">
							<tr>
								<th class="col-md-5">문의제목</th>
								<th class="col-md-2">작성자</th>
								<th class="col-md-2">조회수</th>
								<th class="col-md-3">등록일</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${#lists.size(boardQnaDTOList) > 0}" th:each="l : ${boardQnaDTOList}">
								<th:block th:if="${l.bQnaOpen == 'N'}">
									<td data-title="문의제목" style="text-align: left; padding-left: 20px;">
										<a th:href=@{/help/getQna(bQnaIdx=${l.bQnaIdx})}>[[${l.bQnaSubject}]]</a>
									</td>
								</th:block>
								<th:block th:if="${l.bQnaOpen == 'Y'}">
									<td data-title="문의제목" style="text-align: left; padding-left: 20px;">
										<a data-toggle="modal" data-target="#qnaModal" data-whatever="@mdo" onclick="adminAccess()"><i class="glyphicon glyphicon-lock"></i>[[${l.bQnaSubject}]]</a>
										<input id="bQnaIdx" type="hidden" name="bQnaIdx" th:value="${l.bQnaIdx}">
										<input type="hidden" id="bQnaPassword" th:value="${l.bQnaPassword}"/>
									</td>
								</th:block>
								<td data-title="작성자" th:text="${l.mId}"></td>
								<td data-title="조회수" th:text="${l.bQnaViews}"></td>
								<td data-title="등록일" th:text="${l.bQnaRegDate}"></td>
							</tr>
							<tr th:unless="${#lists.size(boardQnaDTOList) > 0}" >
								<td colspan="9" style="text-align: center;">조회환 내용이 없습니다.</td>
							</tr>
						</tbody>
					</table>
					<div th:include="help/page :: pageFragment"></div>
				</section>
			</div>
		</div>
	</div>
	
		<div class="modal fade" id="qnaModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="exampleModalLabel">비밀번호 확인</h4>
					</div>
					
					<div class="modal-body">
						<form style="text-align:center;">
							<div class="form-group">
								<input type="hidden" id="bQnaPassword" th:value="${bQnaPassword}"/>
								<input type="password" id="inPw"/>
							</div>
							<div class="form-group text-center">
								<button type="button" class="btn btn-info" onclick="pwCheck()">확인</button>
							</div>
						</form>
                	
					</div>
			</div>
		</div>
	</div>
</th:block>
<th:block layout:fragment="customScript">
	<script th:inline="javascript">
	
		//메뉴탭
		var help = $('#help');
		help.addClass('active');
		help.parent().find('.sub').css('display', 'block');
		help.parent().find('.sub').children().eq(1).addClass('active');
		
		
		
		
		
		//비밀번호 체크
		var bQnaIdx = $('#bQnaIdx');
		var bQnaPassword = $('#bQnaPassword');
		var inPw = $('#inPw');
		var admin = "[[${session.SLEVELNUM}]]";
		
		//관리자 접근
		function adminAccess(){
			if(admin == 1){
				location.href="/help/getQna?bQnaIdx=" + bQnaIdx.val(); 
			}
		}
		
		function pwCheck(){
			if(bQnaPassword.val() == inPw.val() ){
				location.href="/help/getQna?bQnaIdx=" + bQnaIdx.val();
			}else{
				alert('비밀번호가 다릅니다.');
				
			}
		}		
		
		
	</script>
	
	
</th:block>
</html>