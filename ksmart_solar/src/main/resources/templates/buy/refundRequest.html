<!DOCTYPE html>
<html xmlns:th="http://www.tyhmeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="@{layout/default}">

	<th:block layout:fragment="customTitle">
				<title>예치금 환불 신청</title>
	</th:block>
	<th:block layout:fragment="Contents">
		<div id="container-header-title"><strong>예치금 환불 완료</strong></div>
		<div id="container-header-path">
			<a href="/" style="text-decoration: none;">메인화면 </a>>
			<a href="#" style="text-decoration: none;"> 구매관리 </a>>
			<a href="/buy/applyRefund" style="text-decoration: none;"> 예치금 환불 </a>>
			<a href="#" style="text-decoration: none;"> 예치금 환불 신청</a>
		</div>
		<div id="container-header-space"></div>
		<div class="row mt">
          <div class="col-lg-12">
            <div class="form-panel">
              <div class="form">
                <form class="cmxform form-horizontal style-form" method="post" th:action="@{/buy/addrefundRequest}">
                	<input type="hidden" name="bCode" th:value="${bCode}">			
	              	<input type="hidden" name="bDeposit" th:value="${bDeposit}">
					<input  type="hidden" name="mId" th:value="${session.SID}">
		              <h4><i class="fa fa-angle-right"></i>예치금 환불 신청</h4>
		              <hr>
	                  <div class="form-group">
	                    <label class="control-label col-lg-2">공고 제목</label>
	                    <div class="col-lg-10">
	                       <div th:text="${bTitle}"></div>
	                    </div>
	                  </div>
	                  <div class="form-group">
	                    <label class="control-label col-lg-2">품목</label>
	                    <div class="col-lg-10">
	                       <div th:text="${bType}"></div>
	                    </div>
	                  </div>
	                  <div class="form-group">
	                    <label class="control-label col-lg-2">출금가능 예치금</label>
	                    <div class="col-lg-10">
		              		<div>
	                    		<span class="price" id="bDeposit">[[${bDeposit}]]</span>원
	                    	</div>
	                    </div>
	                  </div>
	                 <div class="form-group">
		                 <label class="control-label col-lg-2">계좌 선택</label>
			             <div class="col-lg-10" >
				             <select id="bank" class="xsinput mdinput" style="width: 40%; text-align-last:center;">
				             	<option style="text-align: center;">:::::직접 입력:::::</option>
				             	<th:block th:if="${accountList!=null or accountList.size()>0}" th:each="l:${accountList}">
				             		<option th:value="${l.mAccountIdx}">[[${l.mAccountBank+':'+l.mAccountNumber}]]</option>
				             	</th:block>
				             </select>
			             </div>
	                </div>
					<div class="form-group ">
						<label class="control-label col-lg-2">은행</label>
						<div class="col-lg-10">
							<input class="xsinput mdinput" type="text" name="mAccountBankName" style="width: 40%;">
						</div>
					</div>
					<div class="form-group ">
						<label class="control-label col-lg-2">계좌번호</label>
						<div class="col-lg-10">
							<input class="xsinput mdinput" type="text" name="mAccountNumber" style="width: 40%;">
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-lg-2">예금주명</label>
						<div class="col-lg-10" >
							<input class="xsinput mdinput" name="mAccountName" style="width: 40%;" type="text">
						</div>
					</div>
                </form>
              </div>
            </div>
          </div>
        </div>
		<div class="row" style="margin: 5px 0px;">
			<div class="form-inline" style="text-align: center;">
				<button id="bidResultBtn" class="btn btn-theme" type="button" style="width: 80px;">신청</button>
				<button id="bidResultCancelBtn" class="btn btn-danger" type="button" style="width: 80px;">취소</button>
			</div>
		</div>
	</th:block>
	<th:block layout:fragment="customScript">
		<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
		<script type="text/javascript">
			var buy = $('#buy');
			buy.addClass('active');
			buy.parent().find('.sub').css('display','block');
			buy.parent().find('.sub').children().eq(1).addClass('active');
			var form = $('form');
			var bank = $('#bank');
			var mAccountBank = $('[name="mAccountBankName"]');
			var mAccountNumber = $('[name="mAccountNumber"]');
			var mAccountName = $('[name="mAccountName"]');
			var bidResultBtn = $('#bidResultBtn');
			var bidResultCancelBtn = $('#bidResultCancelBtn');
			bank.change(function(){
				//본인 계좌 가져오는 ajax
				$.ajax({
					  url: '/myBank', 
					  method: 'POST',
					  data : {mAccountIdx : $(this).val()},
					  success: function(data){
							if(data != null){
							mAccountBank.val(data.mAccountBank)
							mAccountNumber.val(data.mAccountNumber)
							mAccountName.val(data.mAccountName)
							mAccountName.attr('readonly',true);
							mAccountBank.attr('readonly',true);
							mAccountNumber.attr('readonly',true);
								//집접입력 선택시 입력할 수있도록
								if(bank.val()==':::::직접 입력:::::'){
									mAccountName.attr('readonly',false);
									mAccountBank.attr('readonly',false);
									mAccountNumber.attr('readonly',false);
								}
							}
					  },
					  error : function(xhr,status,error){
						  console.log("xhr: " + xhr);
						  console.log("status: " + status);
						  console.log("error: " + error);
					  }
				});
			});
			$(function(){
				var price = $('.price');
				price.each(function(){
					$(this).text($(this).text().toString().replace(/\B(?=(\d{3})+(?!\d))/g, ','));
				})
			})
			function Check(status){
				Swal.fire({
					  title: '환불실패!',
					  text: status+'을(를) 입력해주세요.',
					  icon: 'info'
					});
			}
			var link = document.referrer;
			bidResultCancelBtn.click(function(){
				location.href = link;
			});
			bidResultBtn.click(function(){
					if(mAccountBank.val()==""){
						mAccountBank.focus();
						Check('은행');
						return false;
					}
					if(mAccountNumber.val()==""){
						mAccountNumber.focus();
						Check('계좌번호');
						return false;
					}
					if(mAccountName.val()==""){
						mAccountName.focus();
						Check('예금주명');
						return false;
					}
					Swal.fire({
						  title: '환불신청 성공!',
						  icon: 'success'
						});
					form.submit();
				});
		</script>
	</th:block>
</html>