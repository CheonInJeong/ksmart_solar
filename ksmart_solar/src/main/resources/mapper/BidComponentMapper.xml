<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Config 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.cafe24.kangk0269.dao.BidComponentMapper">
	<resultMap type="BidComponentDTO" id="BidComponentDTOMap">
		<result property="bCpCode" 			column="b_cp_code" />
		<result property="mId" 				column="sell_id" />
		<result property="bCpTitle" 		column="b_cp_title" />
		<result property="cpCode" 			column="cp_code" />
		<result property="bCpContents"		column="b_cp_contents" />		
		<result property="bCpPrice" 		column="b_cp_price" />	
		<result property="cpUsedate" 		column="cp_usedate" />	
		<result property="bCpStatus" 		column="b_cp_status" />	
		<result property="bCpDate" 			column="b_cp_date" />	
		<result property="bCpDateBidding1" 	column="b_cp_date_bidding1" />	
		<result property="bCpDateBidding2" 	column="b_cp_date_bidding2" />	
		<result property="bCpDateDecision1" column="b_cp_date_decision1" />	
		<result property="bCpDateDecision2" column="b_cp_date_decision2" />	
		<result property="bCpGroupcode" 	column="b_cp_groupcode" />	
		<result property="bCpReCount" 		column="b_cp_re_count" />	
		<result property="bCpConfirm" 		column="b_cp_confirm" />	
		<result property="bCpConfirmStatus" column="b_cp_confirm_status" />	
		<result property="bCpRejectReason" 	column="b_cp_reject_reason" />	
		<result property="bCpCancelReason" 	column="b_cp_cancel_reason" />	
		<result property="bCpCancelDate" 	column="b_cp_cancel_date" />	
		<result property="acStatusCode" 	column="ac_status_code" />
		<association property="bidListDTO" javaType="BidListDTO">
			<id 	property="bCode" 				column="b_code"/>
			<result property="announcedCode" 		column="announced_code" />
			<result property="bTypeCode" 			column="b_type_code" />
			<result property="mId"					column="buy_id" />
			<result property="bPrice" 				column="b_price" />
			<result property="sDepositRate" 		column="s_dep_rate" />
			<result property="bDeposit" 			column="b_deposit" />
			<result property="bDepositCheck" 		column="b_deposit_check" />
			<result property="bMoCode" 				column="b_mo_code" />
			<result property="bDepositDate" 		column="b_deposit_date" />
			<result property="trTypeCode" 			column="tr_type_code" />
			<result property="trTypeName" 			column="tr_type_name" />
			<result property="dcInstructions" 		column="dc_instructions" />
			<result property="dcApplication" 		column="dc_application" />
			<result property="dcProposal" 			column="dc_proposal" />
			<result property="bDate" 				column="b_date" />
			<result property="bCheck" 				column="b_check" />
			<result property="bRank" 				column="b_rank" />
			<result property="bDepositAvailable" 	column="b_deposit_available" />
			<result property="bDepositRefund" 		column="b_deposit_refund" />
			<result property="bDateUp" 				column="b_date_up" />
		</association>	
	</resultMap>
	<resultMap type="ComponentDTO" id="ComponentDTOMap">
		<result property="cpCode" 			column="cp_code" />
		<result property="mId" 				column="m_id" />
		<result property="cpName" 			column="cp_name" />
		<result property="cpInfo" 			column="cp_info" />
		<result property="cpMaker"			column="cp_maker" />		
		<result property="cpMakedate" 		column="cp_makedate" />	
		<result property="cpUsedate" 		column="cp_usedate" />	
		<result property="cpDate" 			column="cp_date" />	
	</resultMap>
	<select id="getBidComponent" resultMap="BidComponentDTOMap" parameterType="String">
		SELECT 
			b_cp_code, 
			cp_code, 
			m_id as sell_id, 
			b_cp_title, 
			b_cp_contents, 
			b_cp_price, 
			cp_usedate, 
			b_cp_status, 
			b_cp_date, 
			b_cp_date_bidding1, 
			b_cp_date_bidding2, 
			b_cp_date_decision1, 
			b_cp_date_decision2, 
			b_cp_groupcode, 
			b_cp_re_count, 
			b_cp_confirm, 
			b_cp_confirm_status, 
			b_cp_reject_reason, 
			b_cp_cancel_reason, 
			b_cp_cancel_date			
		FROM tb_bid_component
		<trim prefix="where">
			<if test="status != null and status.toString() == '종료'.toString() ">		
				ac_status_code > 4						
			</if>
			<if test="status != null and status.toString() == '진행'.toString() ">		
				ac_status_code = 4						
			</if>
		</trim>	
		ORDER BY b_cp_date_bidding1 DESC
	</select>
	
	<select id="getBidComponentByInfo" resultMap="BidComponentDTOMap" parameterType="String">
		SELECT 
			b_cp_code, 
			cp_code, 
			m_id as sell_id, 
			b_cp_title, 
			b_cp_contents, 
			b_cp_price, 
			cp_usedate, 
			b_cp_status, 
			b_cp_date, 
			b_cp_date_bidding1, 
			b_cp_date_bidding2, 
			b_cp_date_decision1, 
			b_cp_date_decision2, 
			b_cp_groupcode, 
			b_cp_re_count, 
			b_cp_confirm, 
			b_cp_confirm_status, 
			b_cp_reject_reason, 
			b_cp_cancel_reason, 
			b_cp_cancel_date,
			ac_status_code			
		FROM tb_bid_component
		WHERE b_cp_code =#{announceCode}
		ORDER BY b_cp_date_bidding1 DESC
	</select>
	<select id="getBidComponentMyBid" resultMap="BidComponentDTOMap" parameterType="String">
		SELECT 
			com.b_cp_title,
			com.b_cp_code,
			li.tr_type_name,
			li.b_date,
			com.b_cp_status,
			com.m_id as sell_id		
		FROM 
			tb_bid_component AS com
		INNER JOIN
			tb_bid_list AS li
		ON li.announced_code = com.b_cp_code
		WHERE
			li.m_id = #{sId}
		ORDER BY li.b_date DESC		
	</select>
	<select id="getComponent" parameterType="String" resultMap="ComponentDTOMap">
		SELECT 
			cp_code, 
			m_id, 
			cp_name, 
			cp_info, 
			cp_maker, 
			cp_makedate, 
			cp_usedate, 
			cp_date
		FROM 
			tb_component
		WHERE 
			cp_code=#{CpCode}
	</select>
</mapper>