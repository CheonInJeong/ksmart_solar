<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  	<mapper namespace="com.cafe24.kangk0269.dao.SellMapper">
  	
  		<resultMap type = "BidPlantDTO" id = "bidPlantResultMap">
  		  		<result property="bPlCode" column="b_pl_code"/>
  		  	  	<result property="bzPlCode" column="bz_pl_code"/>
  		  	  	<result property="mId" column="m_id"/>
  		  	  	<result property="bPlTitle" column="b_pl_title"/>
  				<result property="bPlContents" column="b_pl_contents"/>
  		  		<result property="bPlPrice" column="b_pl_price"/>
  		  		<result property="plDepDataResidual" column="pl_dep_data_residual"/>
  		  		<result property="plDepPrice" column="pl_dep_price"/>
  		  		<result property="plDepStartDate" column="pl_dep_start_date"/>
  		  		<result property="bPlDateRequest" column="b_pl_date_request"/>
  		  		<result property="bPlDateBidding1" column="b_pl_date_bidding1"/>
  		  		<result property="bPlDateBidding2" column="b_pl_date_bidding2"/>
  		  		<result property="bPlDateDecision1" column="b_pl_date_decision1"/>
  		  		<result property="bPlDateDecision2" column="b_pl_date_decision2"/>
  		  		<result property="bPlGroupcode" column="b_pl_groupcode"/>
  		  		<result property="bPlStatus" column="b_pl_status"/>
  		  		<result property="acStatusCode" column = "ac_status_code"/>
  		  		<result property="bPlNumberOfBidder" column="b_pl_number_of_bidder"/>
  		  		<result property="bRecently" column="b_recently"/>
  		  		<association property="businessPlantDTO" javaType="BusinessPlantDTO">
  		  			<id property="bzPlName" column="bz_pl_Name"/>
  		  			<result property="bzPlName" column="bz_pl_name"/>
  		  			<result property="bzPlZipcode" column="bz_pl_zipcode"/>
  		  			<result property="bzPlAddr" column="bz_pl_addr"/>
  		  			<result property="bzPlDetailAddr" column="bz_pl_detail_addr"/>
  		  			<result property="bzPlPhoto" column="bz_pl_photo"/>
  		  			<result property="bzPlPower" column="bz_pl_power"/>
  		  			<result property="bzPlHardware" column="bz_pl_hardware"/>
  		  			<result property="bzPlArea" column="bz_pl_area"/>
  		  			<result property="bzPlInvPower" column="bz_pl_inv_power"/>
  		  			<result property="bzPlInvCount" column="bz_pl_inv_count"/>
  		  			<result property="bzPlInvMaker" column="bz_pl_inv_maker"/>
  		  			<result property="bzPlRec" column="bz_pl_rec"/>
  		  		</association>
  		</resultMap>
  		
  		<resultMap type="BusinessPlantDTO" id="BusinessPlantResultMap">
  		  		<result property="bzPlCode" column="bz_pl_code"/>
  		  		<result property="mId" column="m_id"/>
  		  		<result property="bzPlCheck" column="bz_pl_check"/>
  		  		<result property="bzPlName" column="bz_pl_name"/>
  		  		<result property="bzPlZipcode" column="bz_pl_zipcode"/>
  		  		<result property="bzPlAddr" column="bz_pl_addr"/>
  		  		<result property="bzPlDetail_addr" column="bz_pl_detail_addr"/>
  		  		<result property="bzPlPhoto" column="bz_pl_photo"/>
  		  		<result property="bzPlPower" column="bz_pl_power"/>
  		  		<result property="bzPlHardware" column="bz_pl_hardware"/>
  		  		<result property="bzPlArea" column="bz_pl_area"/>
  		  		<result property="bzPlInvPower" column="bz_pl_inv_power"/>
  		  		<result property="bzPlInvCount" column="bz_pl_inv_count"/>
  		  		<result property="bzPlInvMaker" column="bz_pl_inv_maker"/>
  		  		<result property="bzPlRec" column="bz_pl_rec"/>
  		  		<association property="plantDepreciationDTO" javaType="PlantDepreciationDTO">
  		  			<id property="bzPlCode" column="bz_pl_code"/>
  		  			<result property="bzPlCode" column="bz_pl_code"/>
	  		  		<result property="plDepPrice" column="pl_dep_price"/>
	  		  		<result property="plDepStartDate" column="pl_dep_start_Date"/>
	  		  		<result property="plDepServicelife" column="pl_dep_servicelife"/>
  		  		</association>
  		  		<association property="plantDepDataDTO" javaType="PlantDepDataDTO">
  		  			<id property="bzPlCode" column="bz_pl_code"/>
  		  			<result property="bzPlCode" column="bz_pl_code"/>
  		  			<result property="plDepDataMonth" column="pl_dep_data_month"/>
	  		  		<result property="plDepDataResidual" column="pl_dep_data_residual"/>
  		  		</association>
  		  </resultMap>
  		  <resultMap type="BidListDTO" id="BidListResultMap">
  		  		<result property="bCode" column="b_code"/>
  		  		<result property="announcedCode" column="announced_code"/>
  		  		<result property="bTitle" column="b_title"/>
  		  		<result property="mId" column="m_id"/>
  		  		<result property="bPrice" column="b_price"/>
  		  		<result property="bDepositCheck" column="b_pl_document"/>
  		  		<result property="dcInstructions" column="dc_instructions"/>
  		  		<result property="dcApplication" column="dc_application"/>
  		  		<result property="dcProposal" column="dc_proposal"/>
  		  		<result property="bDate" column="b_date"/>
  		  		<result property="bCheck" column="b_check"/>
  		  		<result property="bRank" column="b_rank"/>
  		  		<association property="businessDTO">
  		  			<result property="mId" column="m_id"/>
  		  			<result property="bzCeoName" column="bz_ceo_name"/>
  		  			<result property="bzCompanyName" column="bz_company_name"/>
  		  			<result property="bzZipcode" column="bz_zipcode"/>
  		  			<result property="bzAddr" column="bz_addr"/>
  		  			<result property="bzDetailAddr" column="bz_detail_addr"/>
  		  		</association>
  		  </resultMap>
  		  <resultMap type="ComponentDTO" id="componentResultMap">
  		  		<result property ="cpCode" column = "cp_code"/>
  		  		<result property ="mId" column = "m_id"/>
  		  		<result property ="cpName" column = "cp_name"/>
  		  		<result property ="cpInfo" column = "cp_info"/>
  		  		<result property ="cpMaker" column = "cp_maker"/>
  		  		<result property ="cpMakedate" column = "cp_makedate"/>
  		  		<result property ="cpUsedate" column = "cp_usedate"/>
  		  		<result property ="cpDate" column = "cp_date"/>
  		  		<association property ="bidComponentDTO" javaType="BidComponentDTO">
  		  			<id property="cpCode" column="cp_code"/>
  		  			<result property="cpCode" column="cp_code"/>
  		  		</association>
  		  </resultMap>
  		  <resultMap type="BidComponentDTO" id="bidComponentResultMap">
  				<result property = "mId" column = "m_id"/>
  		  		<result property = "bCpCode" column = "b_cp_code"/>
  		  		<result property = "cpCode" column = "cp_code"/>
  		  		<result property = "bCpTitle" column = "b_cp_title"/>
  		  		<result property = "bCpContents" column = "b_cp_contents"/>
  		  		<result property = "bCpPrice" column = "b_cp_price"/>
  		  		<result property = "bCpGroupcode" column = "b_cp_groupcode"/>
  		  		<result property = "bCpDateBidding1" column = "b_cp_date_bidding1"/>
  		  		<result property = "bCpDateBidding2" column = "b_cp_date_bidding2"/>
  		  		<result property = "bCpDateDecision1" column = "b_cp_date_decision1"/>
  		  		<result property = "bCpDateDecision2" column = "b_cp_date_decision2"/>
  		  		<result property = "bCpStatus" column = "b_cp_status"/>
  		  		<result property = "bCpBidderNumber" column = "b_cp_bidder_number"/>
  		  		<result property = "bRecently" column = "b_recently"/>
  		  		
  		  		<association property ="componentDTO" javaType="ComponentDTO">
  		  			<id property = "cpCode" column="cp_code"/>
  		  			<result property ="cpName" column="cp_name"/>
  		  			<result property ="cpInfo" column="cp_info"/>
  		  			<result property ="cpMaker" column="cp_maker"/>
  		  			<result property ="cpUsedate" column="cp_usedate"/>
  		  			<result property ="cpMakedate" column="cp_makedate"/>
  		  			<result property ="cpPhoto" column="cp_photo"/>
  		  		</association>
  		  	
  		  </resultMap>
  		  
  		  <resultMap type="TradePriorityDTO" id="tradePriorityResultMap" >
  		  		<result property ="trPrCode" column ="tr_pr_code"/>
  		  		<result property ="bCode" column ="b_code"/>
  		  		<result property ="bTypeCode" column ="b_type_code"/>
  		  		<result property ="announcedCode" column ="announced_code"/>
  		  		<result property ="announcedTitle" column ="announced_title"/>
  		  		<result property ="mIdSeller" column ="m_id_seller"/>
  		  		<result property ="mIdBuyer" column ="m_id_buyer"/>
  		  		<result property ="trPrPrice" column ="tr_pr_price"/>
  		  		<result property ="trPrRank" column ="tr_pr_rank"/>
  		  		<result property ="trPayoutCheck" column ="tr_payout_check"/>
  		  		<result property ="trTypeName" column ="tr_type_name"/>
  		  		<result property ="trPrConclusionDate1" column ="tr_pr_conclusion_date1"/>
  		  		<result property ="trPrConclusionDate2" column ="tr_pr_conclusion_date2"/>
  		  		<association property ="tradePaymentOutDTO" javaType="TradePaymentOutDTO">
  		  			<result property ="trPayoutPrice" column="tr_payout_price"/>
  		  			<result property ="cTradeCm" column="c_trade_cm"/>
  		  			<result property ="trPayoutPriceReal" column="tr_payout_price_real"/>
  		  			<result property ="sCommissionRate" column="s_commission_rate"/>
  		  			<result property ="trPayoutDate" column="tr_payout_date"/>
  		  			<result property ="trPayoutAccount" column="tr_payout_account"/>
  		  			<result property ="trPayoutBank" column="tr_payout_bank"/>
  		  			<result property ="trPayoutWdDate" column="tr_payout_wd_date"/>
  		  			<result property ="trPayoutCode" column="tr_payout_code"/>
  		  		</association>
  		  		<association property ="tradePaymentInDTO" javaType="TradePaymentInDTO">
  		  			<id property="announcedCode" column="announced_code"/>
  		  			<result property ="bMoDate" column="b_mo_date"/>
  		  		</association>
  		  		
  		  </resultMap>
  		  
  		  <resultMap type="MemberAccountDTO" id="memberAccountResultMap">
  		  	<result property="mId" column ="m_id"/>
  		  	<result property="mAccountNumber" column ="m_account_number"/>
  		  	<result property="mAccountName" column ="m_account_Name"/>
  		  	<result property="mAccountBank" column ="m_account_bank"/>
  		  	<result property="mAccountIdx" column ="m_account_idx"/>
  		  </resultMap>
  		  
  		  <resultMap type="TradePaymentOutDTO" id="tradePaymentOutResultMap">
  		  	<result property="trPayoutCode" column ="tr_payout_code"/>
  		  	<result property="trPrCode" column ="tr_pr_code"/>
  		  	<result property="mId" column ="m_id"/>
  		  	<result property="trPayoutPrice" column ="tr_payout_price"/>
  		  	<result property="sCommissionRate" column ="s_commission_rate"/>
  		  	<result property="cTradeCm" column ="c_trade_cm"/>
  		  	<result property="trPayoutPriceReal" column ="tr_payout_price_real"/>
  		  	<result property="trPayoutBank" column ="tr_payout_bank"/>
  		  	<result property="trPayoutAccount" column ="tr_payout_account"/>
  		  	<result property="trPayoutAccountCheck" column ="tr_payout_account_check"/>
  		  	<result property="trPayoutAccountName" column ="tr_payout_account_name"/>
  		  	<result property="trPayoutDate" column ="tr_payout_date"/>
  		  	<result property="trPayoutCheck" column ="tr_payout_check"/>
  		  </resultMap>
  		  
  		  <resultMap type="businessDTO" id="businessResultMap">
  		  	<result property="mId" column ="m_id"/>
  		  	<result property="bzCompanyName" column ="bz_company_name"/>
  		  	<result property="bzCeoName" column ="bz_ceo_name"/>
  		  	<result property="bzZipcode" column ="bz_zipcode"/>
  		  	<result property="bzDetailAddr" column ="bz_detail_addr"/>
  		  	<result property="bzAddr" column ="bz_addr"/>
  		  </resultMap>
  		  
  		  <update id="updateBankInfo" parameterType="String">
  		  		UPDATE tb_trade_payment_out
				SET
					tr_payout_bank=#{accountBank},
					tr_payout_account=#{accountNumber}
				WHERE 
					tr_payout_check ='N' AND tr_payout_code = #{code} 
			  		  
  		  
  		  </update>
  		  
  		  
  		  <select id="getTradeInfo" resultMap="tradePriorityResultMap" parameterType="String">
  		  	SELECT 
				p.announced_code,
				p.m_id_buyer,
				p.tr_pr_price,
				p.tr_pr_rank,
				p.tr_pr_code,
				p.tr_type_name,
				p.tr_pr_conclusion_date1,
				p.tr_pr_conclusion_date2
			FROM 
				tb_trade_payment_in AS i 
			right JOIN 
				tb_trade_priority AS p 
			ON 
				i.tr_pr_code = p.tr_pr_code 
			WHERE p.announced_code =#{announcedCode}
  		  	
  		  </select>
  		  
  		  
  		  <select id="getRecentlybPlCodeByGroupcode" resultType="String" parameterType="String">
  		  	select b_pl_code FROM tb_bid_plant WHERE b_pl_groupcode = #{bPlGroupcode} ORDER BY b_pl_date_decision2 DESC LIMIT 1
  		  </select>
  		  <select id="getPlantAcStatusByCode" parameterType="String" resultType = "int">
  		  	SELECT ac_status_code FROM tb_bid_plant WHERE b_pl_code = #{bPlCode}
  		  
  		  </select>
  		  
  		   <select id="getComponentAcStatusByCode" parameterType="String" resultType = "int">
  		  	SELECT ac_status_code FROM tb_bid_component WHERE b_cp_code = #{bCpCode}
  		  
  		  </select>
  		  
  		  
  		  
  		  <update id="updateBPlantRecentlyNy" parameterType="String">
  		  	UPDATE tb_bid_plant SET b_recently = 'Y' WHERE b_pl_code = #{bPlCode}
  		  </update>
  		  <update id="updateBPlantRecentlyYn" parameterType="String">
  		  	UPDATE tb_bid_plant SET b_recently = 'N' WHERE b_pl_groupcode = #{bPlGroupcode}
  		  </update>
		  <update id="updateBComponentRecentlyNy" parameterType="String">
		  	UPDATE tb_bid_component
			SET
				b_recently='Y'
			WHERE 
				b_cp_code = #{bCpCode}
		  </update>
		  <update id="updateBComponentRecentlyYn" parameterType="String">
		  	UPDATE tb_bid_component
			SET
				b_recently='N'
			WHERE 
				b_cp_groupcode = #{bCpGroupcode}
		  </update>  		
		    
		 <insert id ="addComponentRebidApply" parameterType="BidPlantDTO">
		 	INSERT INTO
		 		tb_bid_component
				(b_cp_code, 
				 cp_code, 
				 m_id, 
				 b_cp_title, 
				 b_cp_contents, 
				 b_cp_price, 
				 cp_usedate,
				 b_cp_status, 
				 ac_status_code, 
				 b_cp_date, 
				 b_cp_date_bidding1, 
				 b_cp_date_bidding2, 
				 b_cp_date_decision1, 
				 b_cp_date_decision2, 
				 b_cp_groupcode, 
				 b_cp_re_count)
			VALUES 
				(sf_b_cp_code(), 
				 #{cpCode}, 
				 #{mId}, 
				 #{bCpTitle}, 
				 #{bCpContents}, 
				 #{bCpPrice}, 
				 #{cpUsedate},  
				 '공고신청', 
				  1, 
				  now(),
				 #{bCpDateBidding1}, 
				 sf_bidding_date(#{bCpDateBidding1}),
				 sf_bidding_date(#{bCpDateBidding1}),
				 sf_decide_bidder_date(#{bCpDateBidding1}),
				 #{bCpGroupcode}, 
				 1)
		 
		 </insert>  
		    
		    
  		  <insert id ="addPlantRebidApply" parameterType="BidPlantDTO">
  		  		INSERT 
  		  		INTO 
  		  			tb_bid_plant
					(b_pl_code, 
					 bz_pl_code,
					 m_id, 
					 b_pl_title, 
					 b_pl_contents, 
					 b_pl_price, 
					 pl_dep_data_residual,
					 b_recently, 
					 pl_dep_price, 
					 pl_dep_start_date, 
					 b_pl_status, 
					 ac_status_code,  
					 b_pl_date_request, 
					 b_pl_date_bidding1, 
					 b_pl_date_bidding2, 
					 b_pl_date_decision1, 
					 b_pl_date_decision2, 
					 b_pl_groupcode,
					 b_pl_re_count)
				VALUES 
					(sf_b_pl_code(), 
				 	 #{bzPlCode}, 
					 #{mId},
					  #{bPlTitle},
					 #{bPlContents}, 
					 ${bPlPrice}, 
					 ${plDepDataResidual}, 
					 'Y', 
					 ${plDepPrice}, 
					 #{plDepStartDate}, 
					 '공고신청', 
					 1, 
					 curdate(),
					 #{bPlDateBidding1}, 
					 sf_bidding_date(#{bPlDateBidding1}),
					 sf_bidding_date(#{bPlDateBidding1}),
					 sf_decide_bidder_date(#{bPlDateBidding1}), 
					 #{bPlGroupcode},
					 1)
  		  </insert>
  		  
  		  
  		  <select id="getPlantInfoForReBid" resultMap = "bidPlantResultMap">
  		  		SELECT 
					b.b_pl_code, 
					b.bz_pl_code, 
					b.m_id, 
					b.b_pl_title,
					b.b_pl_contents,
					b.pl_dep_price, 
					b.b_pl_price, 
					b.b_pl_status, 
					b.ac_status_code,  
					b.b_pl_groupcode, 
					p.bz_pl_name
					(SELECT MAX(b_pl_re_count) FROM tb_bid_plant WHERE bz_pl_code = #{bzPlCode})
				
				FROM
						tb_bid_plant  AS b
					INNER join
					 	tb_business_plant AS p
					 	ON p.bz_pl_code = b.bz_pl_code
					WHERE 
						b.ac_status_code = 9
					AND 
						b.bz_pl_code = #{bzPlCode}
					


  		  </select>
  		  
  		  <select id="getBidPlantAcById" resultMap="bidPlantResultMap">
  		  			SELECT 
  	
  					b.b_pl_code, 
					b.bz_pl_code, 
					b.m_id, 
					b.b_pl_title,
					b.b_pl_contents, 
					b.b_pl_price, 
					b.b_pl_status, 
					b.ac_status_code,  
					b.b_pl_groupcode,
					p.bz_pl_name
  			
				FROM 
						tb_business_plant AS p
				inner JOIN 
					tb_bid_plant AS b 
					
				ON p.bz_pl_code = b.bz_pl_code
				where
					b.m_id = #{mId}
				AND 
					b.ac_status_code =9
				AND 
					b.b_recently = 'Y'	
				<!-- and b_pl_groupcode = (SELECT MAX(b_pl_re_count) FROM tb_bid_plant) -->
  		  	
  		  
  		  </select>
  		  
  		  
  		  <select id="getBidComponentAcById" resultMap="bidComponentResultMap">
  		  		 SELECT
					b.b_cp_code,
					b.cp_code,
					b.m_id,
					b.b_cp_title,
					b.b_cp_contents,
					b.b_cp_price,
					b.cp_usedate,
					b.ac_status_code,
					b.b_cp_status,
					b.b_cp_groupcode,
					c.cp_name 
				FROM 
					tb_bid_component AS b 
				inner JOIN 
					tb_component AS c 
				ON 
					b.cp_code = c.cp_code 
				WHERE  
					b.b_recently = 'Y' 
				AND  
					b.m_id=#{mId}
				AND 
					b.ac_status_code = 9
  		  </select>
  		  
  		  
  		  <select id="getBidComponentAcByIdCode" parameterType="String" resultMap="bidComponentResultMap">
  		  		 SELECT

					b.b_cp_code,
					b.cp_code,
					b.m_id,
					b.b_cp_title,
					b.b_cp_contents,
					b.b_cp_price,
					b.ac_status_code,
					b.b_cp_status,
					b.b_cp_groupcode,
					c.cp_name,
					c.cp_maker,
					c.cp_makedate,
					c.cp_info,
					c.cp_usedate
				FROM 
					tb_bid_component AS b 
				inner JOIN 
					tb_component AS c 
				ON 
					b.cp_code = c.cp_code 
				WHERE  
					b.b_recently = 'Y' 
				AND  
					b.m_id=#{mId}
				AND 
					b.ac_status_code = 9
				and
					b.cp_code = #{cpCode}	
				ORDER BY 
					b.b_cp_date_decision2 DESC LIMIT 1
				
				
  		  
  		  </select>
  		  
  		  <select id="getBidPlantAcByIdCode" parameterType="map" resultMap="bidPlantResultMap">
  		  		SELECT 
  					 p.b_pl_code
  					,p.b_pl_title
  					,p.bz_pl_code
  					,p.b_pl_contents
  					,p.b_pl_price
  					,p.b_pl_status
  					,p.pl_dep_price
  					,p.pl_dep_start_date
  					,p.ac_status_code
  					,b.bz_pl_name
  					,p.b_pl_groupcode
  					,p.pl_dep_data_residual
				FROM 
					tb_bid_plant as p
					
				INNER JOIN 
					
					tb_business_plant AS b
					
				ON 
					p.bz_pl_code = b.bz_pl_code
				WHERE 
					p.m_id =#{mId}
				AND 
					p.ac_status_code =9
				AND 
					p.bz_pl_code = #{bzPlCode}
				And p.b_recently = 'Y'
				ORDER BY
				p.b_pl_date_decision2 DESC LIMIT 1
				
  		  </select>
  		  
  		  
  		  <update id="updateComponentAcStatus">
  		  	UPDATE 
  		  		tb_bid_component
			SET
				b_cp_status='공고마감',
				ac_status_code= 5
			WHERE 
				ac_status_code = 4
  		  	AND 
				b_cp_date_decision1 = CURDATE();
  		  </update>
  		  
  		  <update id="updateComponentAcStatus1">
  		  	UPDATE 
  		  		tb_bid_component
  		  	<if test="state.toString()=='진행'.toString()">
				SET
					b_cp_status='거래진행중',
					ac_status_code= 6
  		  	</if>
  		  	<if test="state.toString()=='취소'.toString()">
				SET
					b_cp_status='공고취소',
					ac_status_code= 8
  		  	</if>
			WHERE 
				ac_status_code = 5
  		  	AND 
  		  		CAST(b_cp_date_decision2 AS DATE) = CURDATE()
			AND
				b_cp_code = #{Code}
  		  </update>
  		  
  		  
  		  <select id="getComponentAcStatus" resultMap="bidComponentResultMap">
  		  	SELECT b_cp_date_decision1 FROM tb_bid_component;
  		  </select>
  		  
  		  
  		  <update id="modifyRank" parameterType="map">
				UPDATE 
					tb_bid_list
				SET
					b_rank=#{bRank}
				WHERE 
					b_code= #{bCode} 		  
  		  </update>
  		  
  		  <select id="rankCheck" parameterType="String" resultMap ="BidListResultMap">
  		  		SELECT
  		  			 b_rank
				FROM 
					tb_bid_list 
				WHERE 
					announced_code = #{bCode}
				and
					b_rank in (1,2)
	
  		  </select>
  		  
  		  <update id="modifyComponentSell" parameterType="BidComponentDTO">
  		  		UPDATE tb_bid_component
					SET
						b_cp_title=#{bCpTitle},
						b_cp_contents=#{bCpContents},
						b_cp_price=#{bCpPrice},
						b_cp_date_bidding1=#{bCpDateBidding1}
					WHERE 
						b_cp_code=#{bCpCode}
				  		  	
  		  </update>
  		  
  		  
  		  <delete id="removeComponentSell" parameterType="String">
  		  		DELETE FROM tb_bid_component WHERE b_cp_code=#{bCpCode}
  		  </delete>
  		  
  		  <insert id="addComponentApply" parameterType="BidComponentDTO">
  		  		INSERT INTO tb_bid_component
					(b_cp_code
					,cp_code
					, m_id
					, b_cp_title
					, b_cp_contents
					, b_cp_price
					, cp_usedate
					, b_cp_date
					, b_cp_date_bidding1
					, b_cp_date_bidding2
					, b_cp_date_decision1
					, b_cp_date_decision2
					, b_cp_groupcode)
				VALUES 
					(sf_b_cp_code()
					, #{cpCode}
					, #{mId}
					, #{bCpTitle}
					, #{bCpContents}
					, #{bCpPrice}
					, #{cpUsedate}
					, now()
					, #{bCpDateBidding1}
					, sf_bidding_date(#{bCpDateBidding1})
					, sf_bidding_date(#{bCpDateBidding1})
					, sf_decide_bidder_date(#{bCpDateBidding1})
					, concat(sf_b_cp_code(),'_group'))

  		  		
  		  	
  		  
  		  </insert>
  		  
  		  <insert id="addComponent">
  		  	INSERT 
  		  	INTO 
  		  		tb_component(cp_code, m_id, cp_name, cp_info, cp_maker, cp_makedate, cp_usedate, cp_date)
			VALUES (sf_cp_code(), #{mId}, #{cpName}, #{cpInfo}, #{cpMaker}, #{cpMakedate}, #{cpUsedate}, NOW())
  		  </insert>
  		  
  		  <update id="updateAcStatus">
  		  	UPDATE 
  		  		tb_bid_plant
			SET
				b_pl_status='공고마감',
				ac_status_code= 5
			WHERE 
				ac_status_code = 4
  		  	AND 
				b_pl_date_decision1 = CURDATE();
  		  </update>
  		  
  		  
  		  <update id="updateAcStatus1">
  		  	UPDATE 
  		  		tb_bid_plant
  		  	<if test="state.toString()=='진행'.toString()">
				SET
					b_pl_status='거래진행중',
					ac_status_code= 6
  		  	</if>
  		  	<if test="state.toString()=='취소'.toString()">
				SET
					b_pl_status='공고취소',
					ac_status_code= 8
  		  	</if>
			WHERE 
				ac_status_code = 5
  		  	AND 
				CAST(b_pl_date_decision2 AS DATE) = CURDATE()
			AND
				b_pl_code = #{Code}
  		  </update>
  		  
  		  <select id="getAcStatus" resultMap="bidPlantResultMap">
  		  	SELECT b_pl_date_decision1 FROM tb_bid_plant;
  		  </select>
  		  
  		  <select id="getBidComponentCode" resultType="String" parameterType="String">
  		  	SELECT b_cp_code FROM tb_bid_component WHERE cp_code = #{cpCode} ORDER BY b_cp_date_decision2 DESC LIMIT 1
  		  </select>
  		  
  		  <select id="getBidPlantCode" parameterType="String" resultMap="bidPlantResultMap">
  		  	SELECT 
  		  		b_pl_code 
  		  	FROM 
  		  		tb_bid_plant 
  		  	WHERE 
  		  		bz_pl_code = #{bzPlCode}
  		  	and
  		  		b_recently = 'Y'
  		 </select>
  		
  		  
  		  <update id="modifyDocumentCheck" parameterType="map">
  		  	UPDATE 
  		  		tb_bid_list
			SET
				b_check=#{bCheck}
			WHERE 
				b_code = #{bCode}
  		  
  		  </update>
  		  
  		  
  		  <select id="getBuyerInfoByCode" parameterType="String" resultMap="BidListResultMap">
  		  	SELECT 
				b.m_id,
				l.announced_code,
				b.bz_ceo_name,
				b.bz_company_name,  
				b.bz_zipcode,b.bz_addr,b.bz_detail_addr,
				l.b_code,
				l.b_check,
				l.b_price,
				l.b_rank	
			FROM 	
				tb_business AS b 
			INNER JOIN 
				tb_bid_list AS l
			ON
				l.m_id = b.m_id
			WHERE
				l.b_code=#{bCode}
  		  </select>
  		  
  		  <update id="modifyApplyYn" parameterType="String">
  		  		UPDATE tb_trade_priority
				SET
					tr_payout_check='Y'
				WHERE tr_pr_code=#{trPrCode}
			  		  	
  		  </update>
  		  
  		  <insert id="addApplyPayment"  parameterType="TradePaymentOutDTO">
				  		  			
				INSERT 
				INTO 
				tb_trade_payment_out(
					tr_payout_code, 
					tr_pr_code,
					m_id, 
					tr_payout_price, 
					s_commission_rate, 
					c_trade_cm, 
					tr_payout_price_real, 
					tr_payout_bank, 
					tr_payout_account, 
					tr_payout_account_check, 
					tr_payout_account_name, 
					tr_payout_date
					)
					VALUES (
					sf_tr_payout_code(),
					 #{trPrCode}, 
					 #{mId}, 
					 #{trPayoutPrice},
					 #{sCommissionRate},
					 #{cTradeCm},
					 #{trPayoutPriceReal}, 
					 #{trPayoutBank},
					 #{trPayoutAccount},
					 'Y',
					 #{trPayoutAccountName}, 
					 NOW()
					)
				  		  
  		  </insert>
  		  
  		  
  		    <select id="getAccountInfoByNumber" resultMap = "memberAccountResultMap" parameterType="String">
  		  		SELECT 
	  		  		m_id, 
	  		  		m_account_number, 
	  		  		m_account_name, 
	  		  		m_account_bank 
  		  		FROM 
  		  			tb_member_account
				WHERE 
					m_account_check = 'Y' 
				AND 
					m_account_number= #{mAccountNumber}
  		  </select>
  		  
  		  
  		  <select id="getMemberAccountById" resultMap = "memberAccountResultMap" parameterType="String">
  		  		SELECT 
	  		  		m_id, 
	  		  		m_account_idx,
	  		  		m_account_number, 
	  		  		m_account_name, 
	  		  		m_account_bank 
  		  		FROM 
  		  			tb_member_account
				WHERE 
					m_account_check = 'Y' 
				AND 
					m_id= #{mId}
  		  </select>
  		  
  		  <select id="getPaymentOutByCode" resultMap = "tradePriorityResultMap" parameterType="String">
  		  		
				SELECT 
			
					p.tr_pr_code,
					p.announced_title,
					p.announced_code,
					p.m_id_buyer,
					p.tr_pr_price, 
					sf_get_commission(p.tr_pr_price) AS comissionRate,
					p.tr_pr_price*sf_get_commission(p.tr_pr_price)/100 AS commission,
					p.tr_pr_price-(p.tr_pr_price*sf_get_commission(p.tr_pr_price)/100) AS availableOut
		
				FROM 
					tb_trade_priority as p 
				
				WHERE 
					p.tr_type_code = 14 
				AND 
					p.tr_pr_code=#{trPrCode}
					

  		  </select>
  		  
  		  
  		  <!--출금신청 가능한 목록  -->
  		  <select id="getPaymentAvailable" resultMap = "tradePriorityResultMap" parameterType="map">
				SELECT 
					pin.b_mo_date,
					p.tr_pr_code,
					p.announced_title,
					p.announced_code,
					p.m_id_buyer,
					p.tr_pr_price, 
					sf_get_commission(p.tr_pr_price) AS comissionRate,
					p.tr_pr_price*sf_get_commission(p.tr_pr_price)/100 AS commission,
					p.tr_pr_price-(p.tr_pr_price*sf_get_commission(p.tr_pr_price)/100) AS availableOut,
					p.tr_payout_check
				FROM 
					tb_trade_priority as p 
				INNER JOIN
					tb_trade_payment_in AS pin
				on
					pin.announced_code = p.announced_code
				where 
					p.tr_type_code = 14 
						AND 
					p.tr_payout_check='N'
				<trim  prefixOverrides="AND / OR ">
					<if test="mId!=null and ''.toString()">
						p.m_id_seller=#{mId}
						
						
					</if>
					<if test="searchValue!=null and ''.toString()">
						and ${searchKey} LIKE CONCAT ('%',#{searchValue},'%')
					</if>
				</trim>
				LIMIT
					#{TradePriorityDTO.pagination.firstRecordIndex},#{TradePriorityDTO.recordsPerPage}

  		  </select>
  		  <select id="getPaymentAvailableCount" resultType = "int" parameterType="map">
				SELECT 
					count(1)
				FROM 
					tb_trade_priority as p 
				INNER JOIN
					tb_trade_payment_in AS pin
				on
					pin.announced_code = p.announced_code
				
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
					<if test="mId!=null and ''.toString()">
						p.m_id_seller=#{mId}
						AND 
						p.tr_type_code = 14 
						AND 
						p.tr_payout_check='N'
					</if>
					<if test="searchValue!=null and ''.toString()">
						and ${searchKey} LIKE CONCAT ('%',#{searchValue},'%')
					</if>
				</trim>

  		  </select>
  		  <!-- 출금신청한 목록  -->
  		  	<select id="getPaymentApplyList" resultMap = "tradePriorityResultMap" parameterType="map">
	  			SELECT 
						p.tr_pr_code,
						p.announced_title,
						p.announced_code,
						p.m_id_buyer,
						pout.tr_payout_price,
						pout.s_commission_rate,
						pout.c_trade_cm,
						pout.tr_payout_price_real,
						p.tr_payout_check,
						pout.tr_payout_check,
						pout.tr_payout_account,
						pout.tr_payout_bank,
						pout.tr_payout_date,
						pout.tr_payout_code
					FROM 
						tb_trade_priority as p 
	
					INNER JOIN
						tb_trade_payment_out AS pout
					on
						p.tr_pr_code = pout.tr_pr_code
					
					<trim prefix="WHERE" prefixOverrides="AND / OR ">
						<if test="mId!=null and ''.toString()">
							p.m_id_seller=#{mId}
						AND 
								
							p.tr_payout_check = 'Y'
						AND 
							pout.tr_payout_check='N'
						</if>
						<if test="searchKeyApply!=null and ''.toString()">
							and ${searchKeyApply} LIKE CONCAT ('%',#{searchValueApply},'%')
						</if>
					
					</trim>	
					LIMIT
					#{TradePriorityDTO.pagination.firstRecordIndex},#{TradePriorityDTO.recordsPerPage}
  		  	</select>
  		  	<select id="getPaymentApplyListCount" resultType = "int" parameterType="map">
	  			SELECT 
						count(1)
					FROM 
						tb_trade_priority as p 
	
					INNER JOIN
						tb_trade_payment_out AS pout
					on
						p.tr_pr_code = pout.tr_pr_code
					
						
					<trim prefix="WHERE" prefixOverrides="AND / OR ">
						<if test="mId!=null and ''.toString()">
							p.m_id_seller=#{mId}
						AND 
								
							p.tr_payout_check = 'Y'
						AND 
							pout.tr_payout_check='N'
						</if>
						<if test="searchKeyApply!=null and ''.toString()">
							and ${searchKeyApply} LIKE CONCAT ('%',#{searchValueApply},'%')
						</if>
					</trim>	
  		  	</select>
  		  
  		  
  		  <!-- -출금완료 목록 -->
  		  <select id="getPaymentOutList" resultMap="tradePriorityResultMap" parameterType="map">
  		  		SELECT 
					p.tr_pr_code,
					p.announced_title,
					p.announced_code,
					p.m_id_buyer,
					pout.tr_payout_price,
					pout.s_commission_rate,
					pout.c_trade_cm,
					pout.tr_payout_price_real,
					p.tr_payout_check,
					pout.tr_payout_check,
					pout.tr_payout_wd_date,
					pout.tr_payout_account,
					pout.tr_payout_bank
				FROM 
					tb_trade_priority as p 

				INNER JOIN
					tb_trade_payment_out AS pout
				on
					p.tr_pr_code = pout.tr_pr_code
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
						<if test="mId!=null and ''.toString()">
							p.m_id_seller=#{mId}
						AND 
								
							p.tr_payout_check = 'Y'
						AND 
							pout.tr_payout_check='Y'
						</if>
						<if test="searchValueFinish!=null and ''.toString()">
							and ${searchKeyFinish} LIKE CONCAT ('%',#{searchValueFinish},'%')
						</if>
				</trim>	
				LIMIT
					#{TradePriorityDTO.pagination.firstRecordIndex},#{TradePriorityDTO.recordsPerPage}
  		  </select>
  		  <select id="getPaymentOutListCount" resultType = "int" parameterType="map">
  		  		SELECT 
					count(1)
				FROM 
					tb_trade_priority as p 

				INNER JOIN
					tb_trade_payment_out AS pout
				on
					p.tr_pr_code = pout.tr_pr_code
					
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
						<if test="mId!=null and ''.toString()">
							p.m_id_seller=#{mId}
						AND 
								
							p.tr_payout_check = 'Y'
						AND 
							pout.tr_payout_check='Y'
						</if>
						<if test="searchValueFinish!=null and ''.toString()">
							and ${searchKeyFinish} LIKE CONCAT ('%',#{searchValueFinish},'%')
						</if>
				</trim>		
					
  		  </select>
  		  
  		  
  		  <select id="getBidderList" resultMap="BidListResultMap" parameterType="String">
  		  		  
  		  	SELECT 
					l.b_code, 
					l.announced_code, 
					l.m_id, 
					l.b_price,  
					l.b_date, 
					l.b_check, 
					l.b_rank
					
				FROM 
					tb_bid_list AS l

				WHERE 
				
					b_deposit_check ='Y'
				AND 
					announced_code =#{code}
				And tr_type_code=3
  		  
  		  </select>
  		  
  	
  		  
  		  <!--부품 코드로 부품 정보 조회  -->
  		  <select id="getComponentInformation" resultMap = "componentResultMap" parameterType="String">
  		  		SELECT 
					cp_code, 
					m_id, 
					cp_name, 
					cp_info, 
					cp_maker, 
					cp_makedate, 
					cp_usedate, 
					cp_date
				FROM
					 tb_component
				WHERE cp_code = #{cpCode}
  		  </select>
  		  <select id="getBidComponentCount" resultType="int" parameterType="map">
  		  		SELECT 
					count(1)
				FROM 
					tb_bid_component AS b
				inner JOIN 
					tb_component AS c 
				ON 
					b.cp_code = c.cp_code
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
					<if test="mId!=null and ''.toString()">
						b.m_id = #{mId}
					</if>
					<if test="searchValueCp!=null and ''.toString()">
						and ${searchKeyCp} LIKE CONCAT ('%',#{searchValueCp},'%')
					</if>
				
				</trim>
  		  </select>
  		  <!--아이디로 등록한 부품공고 조회 -->
  		  <select id="getBidComponentById" resultMap = "bidComponentResultMap" parameterType="map">
  		  		SELECT 
					c.cp_name,
					b.b_cp_code,
					b.cp_code, 
					b.b_cp_title,  
					b.b_cp_price, 
					b.b_cp_status,
					b.b_cp_date_bidding1,
					b.b_cp_date_bidding2,
					b.b_cp_bidder_number
				FROM 
					tb_bid_component AS b
				inner JOIN 
					tb_component AS c 
				ON 
					b.cp_code = c.cp_code
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
					<if test="mId!=null and ''.toString()">
						b.m_id = #{mId}
					</if>
					<if test="searchValueCp!=null and ''.toString()">
						and ${searchKeyCp} LIKE CONCAT ('%',#{searchValueCp},'%')
					</if>
				</trim>
				LIMIT
					#{bidComponentDTO.pagination.firstRecordIndex},#{bidComponentDTO.recordsPerPage}
					
								
  		  </select>
  		  <!--아이디로 가지고 있는 부품정보조회  -->
  		  <select id="getComponent" resultMap = "componentResultMap" parameterType="String">
				SELECT 
					c.cp_code, c.m_id, c.cp_name, c.cp_info, c.cp_maker, c.cp_makedate, c.cp_usedate, c.cp_date

				FROM 
					tb_component AS c
				left JOIN
					tb_bid_component AS b
				
				ON c.cp_code = b.cp_code
				
				WHERE 
					b_cp_code IS null 
				AND
					c.m_id = #{mId}
			 
				
  		  </select>
  		  
  		  <select id="getComponentDetail" resultMap="bidComponentResultMap" parameterType="String">
  		  		SELECT 
					b.b_cp_code,
					b.cp_code,
					b.b_cp_title,
					b.b_cp_contents,
					b.b_cp_price,
					b.cp_usedate,
					b.b_cp_status, 
					b.b_cp_date_bidding1,
					b.b_cp_date_bidding2,
					b.b_cp_date_decision1,
					b.b_cp_date_decision2,
					b.b_cp_bidder_number,
					c.cp_name,
					c.cp_info,
					c.cp_maker,
					c.cp_photo,
					c.cp_usedate,
					c.cp_makedate 
				FROM 
					tb_bid_component AS b 
				INNER JOIN 
					tb_component AS c
				ON 
					b.cp_code = c.cp_code
				WHERE 
				 b.b_cp_code = #{bCpCode}
				 
  		  
  		  </select>
  		  
  		  <select id="getBidPlantDetail" resultMap ="bidPlantResultMap" parameterType="String">
	  		  	SELECT 
	  		  		bz.bz_pl_name,
	  		  		bz.bz_pl_zipcode,
	  		  		bz.bz_pl_addr,
	  		  		bz.bz_pl_detail_addr,
	  		  		bz.bz_pl_photo,
	  		  		bz.bz_pl_power,
	  		  		bz.bz_pl_hardware,
	  		  		bz.bz_pl_area,
	  		  		bz.bz_pl_inv_power,
	  		  		bz.bz_pl_inv_count,
	  		  		bz.bz_pl_inv_maker,
	  		  		bz.bz_pl_rec,
	  		  		b.b_pl_code,
	  		  		b.b_pl_title,
	  		  		b.b_pl_contents,
	  		  		b.b_pl_price,
	  		  		b.pl_dep_data_residual,
	  		  		b.pl_dep_start_date,
	  		  		b.b_pl_status,
	  		  		b.b_pl_number_of_bidder,
	  		  		b.b_pl_date_bidding1,
	  		  		b.b_pl_date_bidding2,
	  		  		b.b_pl_date_decision1,
	  		  		b.b_pl_date_decision2
	  		  	FROM
	 				tb_business_plant as bz 
				INNER JOIN 
				 	tb_bid_plant AS b
				ON 
				 	bz.bz_pl_code = b.bz_pl_code
				WHERE 
					b.b_pl_code = #{bPlCode}
  		  </select>
  		  
  		  <delete id="removePlantApply" parameterType="String">
  		  		DELETE FROM tb_bid_plant WHERE b_pl_code=#{bPlCode}
  		  </delete>
  		  
  		  <update id="modifyPlantApply" parameterType="BidPlantDto">
  		  		UPDATE
  		  			tb_bid_plant
				SET
					b_pl_title=#{bPlTitle},
					b_pl_contents=#{bPlContents},
					b_pl_price=#{bPlPrice},
					b_pl_date_bidding1=#{bPlDateBidding1}
				WHERE 
					b_pl_code = #{bPlCode}
  		  </update>
  		  
  		  <select id="getBidPlantbyCode" resultMap="bidPlantResultMap" parameterType="String">
  		  		SELECT           
					b.b_pl_code,
					b.bz_pl_code,
					b.b_pl_title,
					b.b_pl_contents, 
					b.b_pl_price,
					b.pl_dep_data_residual,
					b.pl_dep_price,
					b.pl_dep_start_date,
					b.b_pl_date_bidding1,
					bz.bz_pl_name
					
				FROM 
					tb_bid_plant as b 
				inner JOIN 
					tb_business_plant AS bz
				ON 
					b.bz_pl_code = bz.bz_pl_code
				WHERE 
					b_pl_code=#{bPlCode}
  		  </select>
  		
  		  <select id="getBidPlantCount" resultType="int" parameterType="map">
  		  		SELECT
				 	count(1)
				FROM 
					tb_bid_plant AS b
				left JOIN 
					tb_business_plant AS p 
				ON 
					b.bz_pl_code = p.bz_pl_code 
				 
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
					<if test="mId!=null and ''.toString()">
						b.m_id = #{mId}
					</if>
					<if test="searchValue!=null and ''.toString()">
						and ${searchKey} LIKE CONCAT ('%',#{searchValue},'%')
					</if>
				</trim>
  		  </select>
  		  <select id="getBidPlantbyId" resultMap="bidPlantResultMap" parameterType="map">
  		  		SELECT
				 	p.bz_pl_name,
				 	b.b_pl_code,
					b.b_pl_title,
					b.b_pl_price,
					b.b_pl_date_bidding1,
					b.b_pl_date_bidding2,
					b.b_pl_status,
					b.b_pl_number_of_bidder,
					b.b_pl_groupcode
				FROM 
					tb_bid_plant AS b
				left JOIN 
					tb_business_plant AS p 
				ON 
					b.bz_pl_code = p.bz_pl_code 
				 
				<trim prefix="WHERE" prefixOverrides="AND / OR ">
					<if test="mId!=null and ''.toString()">
						b.m_id = #{mId} 
					</if>
					<if test="searchValue!=null and ''.toString()">
						and ${searchKey} LIKE CONCAT ('%',#{searchValue},'%')
					</if>
				</trim>
				ORDER BY 
					b.b_pl_date_bidding1 desc , b.b_pl_status asc
				LIMIT
					#{bidPlantDTO.pagination.firstRecordIndex},#{bidPlantDTO.recordsPerPage}
				
				
  		  </select>
  		  <!--발전소 판매 공고 신청  -->
  		  <insert id="addPlantApply" parameterType="BidPlantDTO">
				INSERT 
				INTO
					tb_bid_plant(
					b_pl_code, 
					bz_pl_code,
				 	m_id,
				  	b_pl_title,
				   	b_pl_contents, 
					b_pl_price,
					pl_dep_data_residual,
					pl_dep_price,
					pl_dep_start_date, 
					b_pl_date_request,
					b_pl_date_bidding1,
					b_pl_date_bidding2,
					b_pl_date_decision1,
					b_pl_date_decision2,
					b_pl_groupcode)
					VALUES (
					sf_b_pl_code(), 
					#{bzPlCode}, 
					#{mId}, 
					#{bPlTitle},
					#{bPlContents},
					#{bPlPrice},
					#{plDepDataResidual},
					#{plDepPrice},
					#{plDepStartDate},
					curdate(),
					#{bPlDateBidding1},
					sf_bidding_date(#{bPlDateBidding1}),
					sf_bidding_date(#{bPlDateBidding1}),
					sf_decide_bidder_date(#{bPlDateBidding1}),
					concat(sf_b_pl_code(),'_group'))
  		  </insert>
  		  
  		  <select id="getPlantInformation" resultMap="BusinessPlantResultMap" parameterType="String">
  		  		SELECT
					d.pl_dep_start_date,
					d.pl_dep_price,
					d.bz_pl_code
				FROM 
					tb_plant_depreciation AS d
				WHERE 
					d.bz_pl_code = #{bzPlCode}
  		  
  		  </select>
  		  
  		  <select id="getPlantName" resultMap="BusinessPlantResultMap" parameterType="String">
  		  		SELECT
					p.bz_pl_code,
					p.bz_pl_name 
				FROM 
					tb_bid_plant AS b 
				right JOIN
					tb_business_plant AS p 
				ON
					b.bz_pl_code = p.bz_pl_code 
				WHERE
					b.bz_pl_code IS NULL 
				AND 
					p.m_id = #{mId}

  		  </select>
  		 
  		  
		  		  
  	</mapper>